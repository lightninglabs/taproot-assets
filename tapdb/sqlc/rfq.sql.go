// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: rfq.sql

package sqlc

import (
	"context"
	"database/sql"
)

const FetchActiveRfqPolicies = `-- name: FetchActiveRfqPolicies :many
SELECT
    id,
    policy_type,
    scid,
    rfq_id,
    peer,
    asset_id,
    asset_group_key,
    rate_coefficient,
    rate_scale,
    expiry,
    max_out_asset_amt,
    payment_max_msat,
    request_asset_max_amt,
    request_payment_max_msat,
    price_oracle_metadata,
    request_version,
    agreed_at
FROM rfq_policies
WHERE expiry >= $1
`

func (q *Queries) FetchActiveRfqPolicies(ctx context.Context, minExpiry int64) ([]RfqPolicy, error) {
	rows, err := q.db.QueryContext(ctx, FetchActiveRfqPolicies, minExpiry)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []RfqPolicy
	for rows.Next() {
		var i RfqPolicy
		if err := rows.Scan(
			&i.ID,
			&i.PolicyType,
			&i.Scid,
			&i.RfqID,
			&i.Peer,
			&i.AssetID,
			&i.AssetGroupKey,
			&i.RateCoefficient,
			&i.RateScale,
			&i.Expiry,
			&i.MaxOutAssetAmt,
			&i.PaymentMaxMsat,
			&i.RequestAssetMaxAmt,
			&i.RequestPaymentMaxMsat,
			&i.PriceOracleMetadata,
			&i.RequestVersion,
			&i.AgreedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const InsertRfqPolicy = `-- name: InsertRfqPolicy :one
INSERT INTO rfq_policies (
    policy_type,
    scid,
    rfq_id,
    peer,
    asset_id,
    asset_group_key,
    rate_coefficient,
    rate_scale,
    expiry,
    max_out_asset_amt,
    payment_max_msat,
    request_asset_max_amt,
    request_payment_max_msat,
    price_oracle_metadata,
    request_version,
    agreed_at
)
VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8, $9,
    $10, $11, $12, $13, $14, $15, $16
)
RETURNING id
`

type InsertRfqPolicyParams struct {
	PolicyType            string
	Scid                  int64
	RfqID                 []byte
	Peer                  []byte
	AssetID               []byte
	AssetGroupKey         []byte
	RateCoefficient       []byte
	RateScale             int32
	Expiry                int64
	MaxOutAssetAmt        sql.NullInt64
	PaymentMaxMsat        sql.NullInt64
	RequestAssetMaxAmt    sql.NullInt64
	RequestPaymentMaxMsat sql.NullInt64
	PriceOracleMetadata   sql.NullString
	RequestVersion        sql.NullInt32
	AgreedAt              int64
}

func (q *Queries) InsertRfqPolicy(ctx context.Context, arg InsertRfqPolicyParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, InsertRfqPolicy,
		arg.PolicyType,
		arg.Scid,
		arg.RfqID,
		arg.Peer,
		arg.AssetID,
		arg.AssetGroupKey,
		arg.RateCoefficient,
		arg.RateScale,
		arg.Expiry,
		arg.MaxOutAssetAmt,
		arg.PaymentMaxMsat,
		arg.RequestAssetMaxAmt,
		arg.RequestPaymentMaxMsat,
		arg.PriceOracleMetadata,
		arg.RequestVersion,
		arg.AgreedAt,
	)
	var id int64
	err := row.Scan(&id)
	return id, err
}
